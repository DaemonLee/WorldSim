Architecture Notes
==================

This document is an informally written set of notes on the architecture of
WorldSim.  Very much a work in progress.


Design Questions
----------------

    Each person is assigned a person id within the region they are born or
    first appear.  Person ids are unique only within their region.  Regions
    each have a unique id, which is unique across all regions.  For people
    who travel/migrate to other regions, it would perhaps make sense to
    assign them a new id in the new region.  This would mean a table to
    track migrations or people with "multiple" ids.  Probably put that table
    in the master database.


Execution
---------

    Although there may be a number of different startup programs (to setup
    configuration, allow for command line vs. graphical vs. browser, allow
    for different platforms, etc.), each will launch/start a master
    controller (mc) process.

    The mc reads in the persistent data it needs from the master database.
    If the master database does not exist, the mc will create one.

    Next, the mc initializes the regional processes, giving them any needed
    information (e.g., the location of their regional database).  The mc
    should guarantee that each region is not managed (i.e., updated) by more
    than one process.

    After startup, the mc manages the "world tick", monitors the regional
    processes, and facilitates inter-regional activities.  The mc also
    handles console requests, creating new regions, and running special
    processes (e.g., history/storyline summaries).

    Currently, only a command line console startup program is being
    developed.


Data Persistence
----------------

    Data is stored using SQLite, using multiple database files.  The master
    controller database stores the various controller information, including
    information about the other databases.

    Currently, there are only 2 types of databases.

    1. master database - a single database, with a predefined name
    2. regional database - each region has their own database

    For the current schema documentation (still being drafted), see
    Schema.txt.

    Journaling and possibly backup functions for the master database may
    be added later.  Archiving functionality will probably be needed, at
    some point, for performance reasons.


Calendar
--------

    Currently, only 1 calendar is supported.  This calendar is based on
    earth's (current) tropical calendar, but simplified.  This tropical
    year, unlike earth's, does not vary.

        1 minute = 60 seconds
        1 hour = 60 minutes
        1 day = 24 hours
        1 tropical year = 365.2422 days

    The calendar year starts on the same day as the northern vernal equinox
    and lasts through the day preceeding the next northern vernal equinox.
    This means that most calendar years are 365 days with an extra day
    every few years.

    The lunar cycle and months have not been determined yet.


People
------

    Some quick notes - to be expanded later.  Currently:

        only human genders (male, female)
        not handling sexuality (hetero, gay, trans, etc.)
        only handling two genetic parents (mother, father)
        not handling adoption, foster, biological vs nurturing parents


Libraries
---------

rng
    This random number generator library contains various convenience
    routines to generate pseudo-random numbers.

calendar
    This library contains the routines that handle the calendar and all
    calendar math.  See the Calendar Section in this document for more
    information on the calendar itself.

people
    In progress.
